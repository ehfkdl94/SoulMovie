<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="Home">
	<select id="homelist" resultType="com.soulmovie.vo.MovieVO">
		SELECT MOVIE_CODE, MOVIE_TITLE, MOVIE_ALTERNATIVETITLE, MOVIE_GENRE, MOVIE_ACTOR, MOVIE_CNT, MOVIE_DATE, MOVIE_IMG,B.RANK 
		FROM
			(SELECT 
				MOVIE_CODE, MOVIE_TITLE, MOVIE_ALTERNATIVETITLE, MOVIE_GENRE, MOVIE_ACTOR, MOVIE_CNT, MOVIE_DATE, MOVIE_IMG, 
				ROW_NUMBER() OVER (ORDER BY MOVIE_CNT DESC) RANK    
			FROM 
				MOVIE) B
		WHERE RANK BETWEEN 1 AND 6
	</select>
	
	<resultMap type="com.soulmovie.vo.MovieVO" id="img1">
		<result column="MOVIE_CODE" property="movie_code"/>
		<result column="MOVIE_IMG" property="movie_img" jdbcType="BLOB" javaType="[B"/>
	</resultMap>
	
	<select id="selectMovieImg" parameterType="int" resultMap="img1">
		SELECT MOVIE_CODE, MOVIE_IMG FROM MOVIE WHERE MOVIE_CODE=#{no}
	</select>
	<select id="choicecount" parameterType="String" resultType="int">
		SELECT COUNT(*) FROM CHOICE
	</select>

	
</mapper>